
# Инструкция по использованию

## Требования

1. Убедитесь, что у вас установлена версия PHP 8.1, так как проект написан на Symfony 6.4.
2. Импортируйте дамп базы данных в свою БД:
   - Файл называется `pasteTestDB.sql` и находится в корневой папке проекта.

## Настройка среды

3. Отредактируйте файл `.env`:
   - Измените строку:
     ```
     DATABASE_URL="mysql://(имя пользователя БД):(пароль если имеется)@(адрес сервера или локальный 127.0.0.1:3306)/pasteTestDB?serverVersion=(версия вашей базы данных)"
     ```

## Поддержка Cron

Для автоматического удаления старых записей вы можете использовать Cron, вместо вызова сервиса очистки в контроллере при загрузке страницы. 

### Шаги для настройки Cron:

1. Удалите в файлах `IndexPageController.php` и `PasteController.php` (путь: `/src/Controller/`) следующие строки:
   - `use App\Service\PasteCleanupService;`
   - Параметр конструктора `PasteCleanupService $clear,`
   - Вызов `$clear->cleanupExpiredPastes();`

2. **Настройка Cron:**
   - Откройте терминал на вашем сервере или локальной машине.
   - Запустите редактор crontab, введя команду:
     ```bash
     crontab -e
     ```
   - Вставьте новую строку для регулярного выполнения вашей команды. Например, чтобы запускать команду `app:cleanup-pastes` каждые 5 минут, добавьте следующую строку:
     ```bash
     */5 * * * * /usr/bin/php /path/to/your/symfony/project/bin/console app:cleanup-pastes >> /path/to/your/symfony/project/var/log/cleanup.log 2>&1
     ```
   - Замените `/path/to/your/symfony/project` на фактический путь к вашему проекту Symfony. `>> /path/to/your/symfony/project/var/log/cleanup.log 2>&1` записывает стандартный вывод и ошибки в файл лога `cleanup.log`, что полезно для диагностики в случае возникновения проблем.

### Пример настройки Cron:

Если ваш проект находится в `/var/www/my_project`, строка в crontab будет выглядеть следующим образом:
```bash
*/5 * * * * /usr/bin/php /var/www/my_project/bin/console app:cleanup-pastes >> /var/www/my_project/var/log/cleanup.log 2>&1
```

3. **Сохраните изменения и выйдите из редактора** (если вы использовали nano, нажмите `CTRL + X`, затем `Y`, чтобы подтвердить сохранение, и `ENTER`, чтобы выйти).

4. **Проверьте, что ваш cron работает**:
   - Вы можете посмотреть список задач cron с помощью следующей команды:
     ```bash
     crontab -l
     ```
   - Убедитесь, что вы видите свою новую задачу в списке.

5. **Дополнительное тестирование**:
   - Чтобы убедиться, что ваша команда работает без ошибок, вы можете выполнить её вручную:
     ```bash
     php /path/to/your/symfony/project/bin/console app:cleanup-pastes
     ```
